{"version":3,"sources":["webpack:///webpack/bootstrap fad153910d966020a61a","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///./src/global/models/Cursist.js","webpack:///external \"chalk\"","webpack:///external \"is-js\"","webpack:///./src/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"body-parser\"","webpack:///external \"cors\"","webpack:///external \"http\"","webpack:///external \"ip\"","webpack:///./src/factories/createAuthHandler.js","webpack:///external \"passport\"","webpack:///external \"passport-jwt\"","webpack:///./src/global/constants.js","webpack:///./src/controllers/auth.js","webpack:///external \"bcrypt\"","webpack:///external \"express-validator/check\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"uuid/v4\"","webpack:///./src/controllers/home.js","webpack:///./src/global/models/Cursus.js","webpack:///./src/services/log.js","webpack:///external \"stack-trace\"","webpack:///./src/socket.js","webpack:///external \"socket.io\"","webpack:///./src/global/mongoUri.js","webpack:///external \"dotenv\""],"names":["mongoose","require","schema","Schema","id","type","String","required","unique","username","maxLength","password","role","default","Cursist","model","module","exports","MONGO_URI","config","Server","onListen","err","error","port","process","env","__DEV__","warn","info","ip","address","toString","connectToDb","connect","useMongoClient","Promise","global","db","connection","on","console","log","Error","once","start","catch","app","use","bodyParser","json","cors","createAuthHandler","setRoutes","http","socket","bindSockets","listen","route","isPrivate","allowedRoles","path","controller","is","set","checkRole","req","res","next","length","status","send","express","PORT","options","jwtFromRequest","ExtractJwt","fromExtractors","fromAuthHeaderAsBearerToken","fromUrlQueryParameter","fromHeader","secretOrKey","secretKey","passport","jwtPayload","done","User","find","sub","user","authMiddleware","authenticate","session","ROLES","admin","manager","ROUTES","Cursus","cursussen","cursisten","cursusId","body","cursus","inschrijvingen","inschrijving","cursist","push","Auth","Router","validations","checkIfValidatorFailed","post","password1","message","uuid","hash","Number","salt","create","usr","token","sign","compare","Home","get","cursustitel","cursusprijs","begindatum","einddatum","misc","DEBUG","content","trace","funcName","getFunctionName","substr","rest","debug","Socket","io"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap fad153910d966020a61a","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 2\n// module chunks = 0","const mongoose = require('mongoose');\n\nconst schema = new mongoose.Schema({\n    id: { type: String, required: true, unique: true },\n    username: { type: String, maxLength: 255, required: true, unique: true, },\n    password: { type: String, maxLength: 255, required: true },\n    role: { type: String, maxLength: 255, default: 'gebruiker' },\n});\n\nconst Cursist = mongoose.model('Cursist', schema);\n\nmodule.exports = Cursist;\n\n\n\n// WEBPACK FOOTER //\n// ./src/global/models/Cursist.js","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"is-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"is-js\"\n// module id = 5\n// module chunks = 0","import bodyParser from 'body-parser';\nimport chalk from 'chalk';\nimport * as cors from 'cors';\nimport express from 'express';\nimport { Server as HttpServer } from 'http';\nimport ip from 'ip';\nimport is from 'is-js';\nimport mongoose from 'mongoose';\nimport createAuthHandler, { authMiddleware } from './factories/createAuthHandler';\nimport { ROUTES } from './global/constants';\nimport { error, info, warn } from './services/log';\nimport Socket from './socket';\n\nconst MONGO_URI = require('./global/mongoUri').MONGO_URI;\n\nrequire('dotenv').config();\n\nclass Server {\n    port;\n\n    constructor () {\n        this.app = express();\n        this.port = process.env.PORT || 3004;\n        this.connectToDb()\n            .catch(err => error(err));\n    }\n\n    onListen = (err) => {\n        if (err) {\n            error(`Unable to start server on port ${this.port}`, err);\n            return;\n        }\n\n        if (process.env.__DEV__) {\n            warn('We\\'re in development mode.');\n        }\n\n        info(`We're live.\\r\\n`);\n        info(chalk`{bold On your network:}     {underline http://${ip.address('public')}:{bold ${this.port.toString()}}/}`);\n        info(chalk`Local:               {underline http://${ip.address('private')}:{bold ${this.port.toString()}}/}`);\n    };\n\n    connectToDb = async () => {\n        try {\n            mongoose.connect(MONGO_URI, {\n                useMongoClient: true,\n            });\n            mongoose.Promise = global.Promise;\n            const db = mongoose.connection;\n\n            db.on('error', (err) => {\n                console.log();\n                error(err);\n                throw new Error(err);\n            });\n            db.once('open', () => {\n                info('Successfully connected to database!');\n                console.log();\n                this.start()\n                    .catch(err => {\n                        console.log();\n                        error(err);\n                        throw new Error(err);\n                    });\n            });\n        } catch (err) {\n            throw new Error(err);\n        }\n    };\n\n    start = async () => {\n        this.app.use(bodyParser.json());\n        // TODO Change cors to not allow all origins, just frontend location.\n        this.app.use(cors());\n        createAuthHandler();\n        this.setRoutes();\n        const http = new HttpServer(this.app);\n        this.socket = new Socket(http);\n        this.socket.bindSockets();\n        http.listen(this.port, this.onListen);\n    };\n\n    setRoutes = () => {\n\n        for (const route of ROUTES) {\n            const { isPrivate, allowedRoles, path, controller } = route;\n\n            if (!is.set(isPrivate) || !is.set(allowedRoles) || !is.set(path) || !is.set(controller) || typeof controller !== 'function') {\n                continue;\n            }\n\n            const checkRole = (req, res, next) => {\n                // TODO implement roles. Get user via req.user and check if the role is supported\n                next();\n            };\n\n            // TODO Implement roles\n            if (isPrivate === true && allowedRoles.length === 0) {\n                this.app.use(path, authMiddleware, controller);\n            } else if (allowedRoles.length > 0 && isPrivate === true) {\n                this.app.use(path, authMiddleware, checkRole, controller);\n            } else if (isPrivate === false) {\n                this.app.use(path, controller);\n            }\n        }\n\n        // Last route, 404 handler\n        this.app.use('*', (req, res) => {\n            res.status(404).send('Not found');\n        });\n    };\n}\n\nexport default new Server();\n\nprocess.on('unhandledRejection', function () {\n    // Handle unhandledrejection if needed, if nothing is here unhandled rejections will get ignored\n});\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cors\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"ip\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ip\"\n// module id = 12\n// module chunks = 0","import passport from 'passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport User from '../global/models/Cursist';\n\nexport default () => {\n    const options = {\n        jwtFromRequest: ExtractJwt.fromExtractors([\n            ExtractJwt.fromAuthHeaderAsBearerToken(),\n            ExtractJwt.fromUrlQueryParameter('auth'),\n            ExtractJwt.fromHeader('authenticationToken'),\n        ]),\n        secretOrKey: process.env.secretKey,\n    };\n\n    passport.use(new Strategy(options, async (jwtPayload, done) => {\n        const user = (await User.find({ id: jwtPayload.sub }))[0];\n        if (user) {\n            return done(null, user);\n        } else {\n            return done(null, false);\n        }\n    }));\n}\n// TODO Add role verification here\nexport const authMiddleware = passport.authenticate('jwt', { session: false });\n\n\n// WEBPACK FOOTER //\n// ./src/factories/createAuthHandler.js","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"passport-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-jwt\"\n// module id = 15\n// module chunks = 0","import Auth from '../controllers/auth';\nimport Home from '../controllers/home';\nimport Cursus from './models/Cursus';\nimport Cursist from './models/Cursist';\n\nexport const ROLES = {\n    admin: 'admin',\n    manager: 'manager',\n    user: 'user',\n};\n\nexport const ROUTES = [\n    {\n        path: '/',\n        controller: Home,\n        allowedRoles: [],\n        isPrivate: false,\n    },\n    {\n        path: '/auth',\n        controller: Auth,\n        allowedRoles: [],\n        isPrivate: false,\n    },\n    {\n        path: '/someAuthedRoute',\n        controller: (req, res) => {\n            res.send('hi from authed route');\n        },\n        allowedRoles: [],\n        isPrivate: true,\n    },\n    {\n        path: '/api/getAllCursus',\n        controller: async (req,res) => {\n            res.json({\n                cursussen: await Cursus.find({}),\n            });\n        },\n        allowedRoles: [],\n        isPrivate: false,\n    },\n    {\n        path: '/api/getAllCursistenFromCursus',\n        controller: async (req,res) => {\n            const cursisten = [];\n            const cursusId = req.body.cursusId;\n            const cursus = (await Cursus.find({ id: cursusId }))[0];\n            if(!cursus.inschrijvingen) {\n                res.json({\n                    cursisten: [],\n                });\n            }\n            for (const inschrijving of cursus.inschrijvingen) {\n                const cursist = (await Cursist.find({ id: inschrijving }))[0];\n                cursisten.push(cursist);\n            }\n            res.json({\n                cursisten\n            });\n        },\n        allowedRoles: [],\n        isPrivate: false,\n    }\n];\n\n\n// WEBPACK FOOTER //\n// ./src/global/constants.js","import { compare, hash } from 'bcrypt';\nimport { Router } from 'express';\nimport { check, validationResult } from 'express-validator/check';\nimport is from 'is-js';\nimport { sign } from 'jsonwebtoken';\nimport uuid from 'uuid/v4';\nimport User from '../global/models/Cursist';\n\nconst Auth = Router();\n\n\n// Disable validation since who cares about any of that right. 🤷‍\n\nconst validations = (req, res, next) => {\n    next();\n};\n\n// const validations = [\n//     check('username').exists().isAlphanumeric(),\n//     check('password1').exists().isLength({ min: 6 }),\n// ];\n\nconst checkIfValidatorFailed = async (req, res, next) => {\n    // const errors = validationResult(req);\n    // if (!errors.isEmpty()) {\n    //     const message = errors.formatWith(({ param }) => {\n    //         return `Invalid ${param} value`;\n    //     }).array();\n    //     return res.status(422).json({ message: message[message.length - 1] });\n    // }\n    next();\n};\n\nAuth.post('/register', validations, checkIfValidatorFailed, async (req, res, next) => {\n    try {\n        const { username, password1 } = req.body;\n        const user = (await User.find({ username: username }))[0];\n        if (is.set(user)) {\n            res.status(422);\n            return res.json({\n                message: 'User already exists',\n            });\n        } else if (!is.set(user)) {\n            const id = uuid();\n            const user = {\n                id,\n                username,\n                password: await hash(password1, Number(process.env.salt)),\n            };\n            await User.create(user);\n            const usr = (await User.find({ id: id }))[0];\n            return res.json({\n                token: sign({ sub: id }, process.env.secretKey),\n                role: usr.role,\n            });\n        }\n    } catch (err) {\n        next(err);\n    }\n});\n\nAuth.post('/login', validations, checkIfValidatorFailed, async (req, res, next) => {\n    try {\n        const { username, password1 } = req.body;\n        const user = (await User.find({ username: username }))[0];\n        if (!user) {\n            res.status(422);\n            return res.json({\n                message: 'User does not exist',\n            });\n        }\n        if (!await compare(password1, user.password)) {\n            res.status(422);\n            return res.json({\n                message: 'Incorrect password',\n            });\n        }\n        return res.json({\n            token: sign({ sub: user.id }, process.env.secretKey),\n            role: user.role,\n        });\n    } catch (err) {\n        next(err);\n    }\n});\n\nexport default Auth;\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/auth.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"express-validator/check\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-validator/check\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"uuid/v4\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid/v4\"\n// module id = 21\n// module chunks = 0","import { Router } from 'express';\n\nconst Home = Router();\n\nHome.get('/', (req, res) => {\n    res.send('hi from api / backend');\n});\n\nexport default Home;\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/home.js","const mongoose = require('mongoose');\n\nconst schema = new mongoose.Schema({\n    id: { type: String, required: true, unique: true },\n    cursustitel: { type: String, required: true },\n    cursusprijs: { type: Number },\n    begindatum: { type: String, required: true },\n    einddatum: { type: String, required: true },\n    inschrijvingen: { type: [] },\n});\n\nconst Cursus = mongoose.model('Cursus', schema);\n\nmodule.exports = Cursus;\n\n\n\n// WEBPACK FOOTER //\n// ./src/global/models/Cursus.js","import chalk from 'chalk';\nimport { get } from 'stack-trace';\n\nconst log = (type = 'log', message, ...misc) => {\n    if (type === 'debug' && process.env.DEBUG !== 'true') {\n        return;\n    }\n    let content = [];\n    switch (type) {\n        case 'log':\n            content = [chalk`{bold.cyan INFO}`];\n            break;\n        case 'error':\n            content = [chalk`{bold.red ERR!}`];\n            break;\n        case 'warn':\n            content = [chalk`{bold.yellow WARN}`];\n            break;\n        case 'debug': {\n            const trace = get();\n            const funcName = trace[2].getFunctionName();\n            content = [chalk`{bold.magenta VERB} ${funcName ? chalk`{bgBlack.white  ${funcName.substr(0, 15)} }` : ''}`];\n            break;\n        }\n        default:\n            throw new Error(`Invalid log type: ${type}`);\n    }\n\n    content = [...content, message, ...misc];\n\n    console[type === 'debug' ? 'log' : type](...content);\n};\n\nexport const info = (message, ...rest) => log('log', message, ...rest);\nexport const error = (message, ...rest) => log('error', message, ...rest);\nexport const warn = (message, ...rest) => log('warn', message, ...rest);\nexport const debug = (message, ...rest) => log('debug', message, ...rest);\n\n\n// WEBPACK FOOTER //\n// ./src/services/log.js","module.exports = require(\"stack-trace\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"stack-trace\"\n// module id = 25\n// module chunks = 0","import io from 'socket.io';\n\nexport default class Socket {\n\n    constructor (http) {\n        this.io = io(http);\n    }\n\n    bindSockets () {\n        // bind sockets here\n        // samples\n        // this.io.emit('bla', {bla: 'bla' });\n        // this.io.on('bla', (data) => { info(data) });\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/socket.js","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 27\n// module chunks = 0","module.exports.MONGO_URI = 'mongodb://127.0.0.1/zeilschooldewaai';\n\n\n// WEBPACK FOOTER //\n// ./src/global/mongoUri.js","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 29\n// module chunks = 0"],"sourceRoot":""}